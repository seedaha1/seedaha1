<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù„Ø¹Ø¨Ø© ØµÙŠØ¯Ù‡Ø§ - Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ©</title>
    <style>
        :root {
            /* Ø§Ø³ØªØ®Ø¯Ù… Ù‚ÙŠÙ… Ø«Ø§Ø¨ØªØ© Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† Ù…Ù„ÙÙƒ ÙˆÙ„ÙƒÙ† Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© */
            --cell-size: 85px; /* Ø­Ø¬Ù… Ù…ÙˆØ­Ø¯ Ù„Ù„Ø®Ù„Ø§ÙŠØ§ Ù„ØªØ¨Ø¯Ùˆ Ù…Ø±Ø¨Ø¹Ø© */
            --grid-gap-size: 8px; /* ÙØ¬ÙˆØ© Ø£ØµØºØ± Ø¨ÙŠÙ† Ø§Ù„Ø®Ù„Ø§ÙŠØ§ */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e6f7ff;
            color: #222;
            text-align: center;
            padding: clamp(10px, 3vw, 20px); /* Responsive padding */
            margin: 0;
            direction: rtl;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
            position: relative;
        }

        /* Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© */
        .legal-notice {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #ffe0b2;
            color: #8d6e63;
            padding: clamp(5px, 2vw, 8px) clamp(10px, 3vw, 15px); /* Responsive padding */
            font-size: clamp(12px, 1.5vw, 14px); /* Responsive font size */
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-bottom: 1px solid #d7ccc8;
            line-height: 1.5;
            text-align: center;
        }
        .legal-notice span {
            display: block;
            margin-top: 5px;
            font-style: italic;
            font-weight: normal;
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out;
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
            display: flex;
        }

        .modal-content {
            background-color: #ffffff;
            padding: clamp(20px, 5vw, 30px); /* Responsive padding */
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 90%;
            text-align: center;
            line-height: 1.6;
            animation: fadeIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
            color: #333;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-content h2 {
            color: #007bff;
            margin-bottom: clamp(15px, 3vw, 20px); /* Responsive margin */
            font-size: clamp(1.5em, 4vw, 2em); /* Responsive font size */
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            margin: clamp(15px, 4vw, 20px) 0;
        }

        .modal-content ul li {
            margin-bottom: 10px;
            font-size: clamp(1em, 2.5vw, 1.1em); /* Responsive font size */
            text-align: right;
            padding-right: 10px;
            border-right: 3px solid #007bff;
        }

        .modal-content p {
            font-size: clamp(1em, 2.5vw, 1.1em); /* Responsive font size */
            margin-top: clamp(20px, 4vw, 25px); /* Responsive margin */
            font-weight: bold;
            color: #555;
        }
        .modal-content .button-group {
            margin-top: clamp(20px, 5vw, 30px);
        }
        .modal-content button {
            background-color: #004080;
            color: white;
            border: none;
            padding: clamp(12px, 4vw, 18px) clamp(25px, 6vw, 35px); /* Responsive padding */
            border-radius: 8px;
            font-size: clamp(1em, 3vw, 1.3em); /* Responsive font size */
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0 clamp(5px, 1.5vw, 10px); /* Responsive margin */
        }
        .modal-content button:hover {
            background-color: #003366;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ù‚ */
        #teamSelectionModal .team-options {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping */
            justify-content: center;
            gap: clamp(10px, 3vw, 20px); /* Responsive gap */
            margin-top: clamp(20px, 5vw, 30px);
        }
        #teamSelectionModal .team-options button {
            font-size: clamp(1em, 3vw, 1.3em); /* Responsive font size */
            padding: clamp(12px, 4vw, 18px) clamp(25px, 6vw, 35px); /* Responsive padding */
        }

        /* Ø´Ø§Ø´Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„ÙØ±Ù‚ */
        #teamNameInputModal .team-name-inputs {
            display: flex;
            flex-direction: column;
            gap: clamp(10px, 3vw, 15px); /* Responsive gap */
            margin-top: clamp(15px, 4vw, 20px);
        }
        #teamNameInputModal .team-name-inputs div {
            display: flex;
            align-items: center;
            gap: clamp(5px, 2vw, 10px); /* Responsive gap */
        }
        #teamNameInputModal .team-name-inputs label {
            font-weight: bold;
            min-width: clamp(60px, 15vw, 80px); /* Responsive min-width */
            text-align: right;
            color: #007bff;
            font-size: clamp(0.9em, 2vw, 1em); /* Responsive font size */
        }
        #teamNameInputModal .team-name-inputs input[type="text"] {
            flex-grow: 1;
            padding: clamp(8px, 2.5vw, 12px); /* Responsive padding */
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: clamp(0.9em, 2.5vw, 1.1em); /* Responsive font size */
            text-align: right;
        }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¹Ø¨Ø© */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 900px;
        }

        .scoreboard {
            display: flex;
            justify-content: center;
            gap: clamp(10px, 3vw, 20px); /* Responsive gap */
            margin: clamp(10px, 3vw, 20px) 0 clamp(5px, 2vw, 10px); /* Responsive margins */
            flex-wrap: wrap;
        }

        .team {
            padding: clamp(8px, 2.5vw, 12px) clamp(15px, 4vw, 20px); /* Responsive padding */
            border-radius: 12px;
            background: #e0f7fa;
            font-weight: bold;
            font-size: clamp(1em, 2.5vw, 1.1em); /* Responsive font size */
            min-width: clamp(100px, 20vw, 120px); /* Responsive min-width */
            border: 3px solid transparent;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .team span {
            font-size: clamp(1.5em, 4vw, 1.8em); /* Responsive font size */
            margin-top: 5px;
            color: #004085;
        }

        /* ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø°ÙŠ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ± */
        .team.active {
            border-color: #007bff;
            box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
            transform: translateY(-5px);
        }

        .controls {
            margin: clamp(15px, 4vw, 20px) 0;
            display: flex;
            flex-wrap: wrap; /* Allow wrapping */
            justify-content: center;
            gap: clamp(10px, 3vw, 15px); /* Responsive gap */
        }

        .controls button {
            background-color: #004080;
            color: white;
            border: none;
            padding: clamp(12px, 4vw, 18px) clamp(25px, 6vw, 35px); /* Responsive padding */
            border-radius: 10px;
            font-size: clamp(1em, 3vw, 1.3em); /* Responsive font size */
            margin: 0;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .timer {
            font-size: clamp(20px, 5vw, 28px); /* Responsive font size */
            font-weight: bold;
            margin-bottom: clamp(10px, 3vw, 15px); /* Responsive margin */
            color: #333;
            min-height: 35px;
        }

        /* Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø´Ø¨ÙƒØ© */
        .grid {
            display: grid;
            grid-gap: var(--grid-gap-size);
            justify-content: center;
            margin: clamp(10px, 3vw, 20px) auto;
            max-width: fit-content;
        }

        /* Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© - Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† Ù…Ù„ÙÙƒ */
        .cell {
            width: var(--cell-size); /* Ø­Ø¬Ù… Ù…ÙˆØ­Ø¯ Ù„Ù„Ø®Ù„Ø§ÙŠØ§ */
            height: var(--cell-size); /* Ù„Ø¶Ù…Ø§Ù† Ø´ÙƒÙ„ Ù…Ø±Ø¨Ø¹ */
            border-radius: 15px; /* Ù„Ù… Ù†Ø¹Ø¯ Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© Ù‡Ù†Ø§ Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø°Ù„Ùƒ */
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease, filter 0.3s ease;
            user-select: none;
            color: #222;
            text-align: center;
            line-height: 1.2;
            padding: 5px;
            box-sizing: border-box;
            /* removed aspect-ratio as we now have fixed width/height */
        }

        /* Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø´Ø¨ÙƒØ© Ø­Ø³Ø¨ Ø§Ù„Ø¬ÙˆÙ„Ø© - ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø«Ø§Ø¨Øª */
        .grid.size-15 {
            /* 5 Ø£Ø¹Ù…Ø¯Ø© * Ø­Ø¬Ù… Ø§Ù„Ø®Ù„ÙŠØ© + 4 * Ø§Ù„ÙØ¬ÙˆØ© */
            grid-template-columns: repeat(5, var(--cell-size));
            grid-template-rows: repeat(3, var(--cell-size)); /* 3 ØµÙÙˆÙ Ù„Ù€ 15 Ø®Ù„ÙŠØ© */
            width: fit-content; /* ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        }
        /* Ù„Ù… Ù†Ø¹Ø¯ Ø¨Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø¯Ø§Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙ„Ø§Ø³ Ù„Ø£Ù†Ù‡Ø§ ØªØ­Ø¯Ø¯Ù‡Ø§ var(--cell-size) */

        .grid.size-18 {
            /* 6 Ø£Ø¹Ù…Ø¯Ø© * Ø­Ø¬Ù… Ø§Ù„Ø®Ù„ÙŠØ© + 5 * Ø§Ù„ÙØ¬ÙˆØ© */
            grid-template-columns: repeat(6, var(--cell-size));
            grid-template-rows: repeat(3, var(--cell-size)); /* 3 ØµÙÙˆÙ Ù„Ù€ 18 Ø®Ù„ÙŠØ© */
            width: fit-content; /* ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        }
        /* Ù„Ù… Ù†Ø¹Ø¯ Ø¨Ø­Ø§Ø¬Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø¯Ø§Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙ„Ø§Ø³ Ù„Ø£Ù†Ù‡Ø§ ØªØ­Ø¯Ø¯Ù‡Ø§ var(--cell-size) */

        /* Ù†Ù…Ø· Ø®Ø§Øµ Ù„Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØµÙˆØµ Ø£Ùˆ Ø£Ø±Ù‚Ø§Ù… Ø­Ø³Ø§Ø¨ÙŠØ© */
        .cell.text-content {
            font-size: clamp(18px, 3.5vw, 30px); /* Responsive font size */
            font-weight: bold;
            white-space: normal; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± */
            word-break: break-word;
        }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø®Ø· Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§Ø¯ÙØ§Øª/Ø§Ù„Ø£Ø¶Ø¯Ø§Ø¯ ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© */
        .cell[data-round-type="words"],
        .cell[data-round-type="math"],
        .cell[data-round-type="letter-word"],
        .cell[data-round-type="incomplete-word"] {
            font-size: clamp(16px, 3vw, 28px); /* Ø£ØµØºØ± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ø§Ù„Ù†ØµÙˆØµ */
        }
        /* ØªØ¹Ø¯ÙŠÙ„ Ø®Ø§Øµ Ù„Ø­Ø¬Ù… Ø®Ø· Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙˆØ§Ù„Ù†Ø¬Ù…Ø© */
        .cell[data-round-type="emoji"],
        .cell[data-special-type="star-placeholder"] {
            font-size: clamp(28px, 6vw, 40px); /* Responsive font size */
        }

        /* Ù…ÙƒØ§Ù† ÙˆØªØµÙ…ÙŠÙ… Ø±Ø³Ø§Ù„Ø© "Ø¯ÙˆØ± Ø§Ù„ÙØ±ÙŠÙ‚" */
        .result {
            margin-top: clamp(5px, 2vw, 10px);
            margin-bottom: clamp(10px, 3vw, 20px);
            font-size: clamp(18px, 4vw, 24px); /* Responsive font size */
            font-weight: bold;
            color: #007bff;
            min-height: 30px;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø§Ù„ÙØ®Ù…Ø© */
        #countdownOverlay {
            font-size: clamp(3em, 10vw, 5em); /* Responsive font size */
        }

        #countdownText {
            margin-bottom: clamp(10px, 3vw, 20px);
            font-size: clamp(0.3em, 1.5vw, 0.5em); /* Responsive font size */
        }

        #countdownNumber {
            font-size: clamp(1.5em, 5vw, 2em); /* Responsive font size */
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© */
        #finalWinnerModal h2 {
            font-size: clamp(2.5em, 8vw, 4em); /* Responsive font size */
            margin-bottom: clamp(20px, 5vw, 30px);
        }
        #finalWinnerModal p {
            font-size: clamp(1.5em, 4vw, 2em); /* Responsive font size */
            margin-bottom: clamp(25px, 6vw, 40px);
        }
        #finalWinnerModal button {
            padding: clamp(15px, 5vw, 20px) clamp(30px, 8vw, 40px);
            font-size: clamp(1.2em, 3.5vw, 1.5em);
            margin: 0 clamp(5px, 2vw, 10px);
        }

        /* Small screen adjustments */
        @media (max-width: 768px) {
            :root {
                --cell-size: 75px; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ù„ÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£ØµØºØ± */
                --grid-gap-size: 6px;
            }
            .cell.text-content {
                font-size: clamp(14px, 3vw, 25px);
            }
            .cell[data-round-type="words"],
            .cell[data-round-type="math"],
            .cell[data-round-type="letter-word"],
            .cell[data-round-type="incomplete-word"] {
                font-size: clamp(12px, 2.5vw, 22px);
            }
            .cell[data-round-type="emoji"],
            .cell[data-special-type="star-placeholder"] {
                font-size: clamp(22px, 5vw, 35px);
            }
            .team {
                min-width: unset;
                flex-basis: 45%;
            }
            .scoreboard {
                gap: clamp(5px, 2vw, 10px);
            }
        }

        @media (max-width: 480px) {
            :root {
                --cell-size: 60px; /* ØªØµØºÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø®Ù„ÙŠØ© Ø£ÙƒØ«Ø± Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
                --grid-gap-size: 5px;
            }
            .grid.size-15 {
                /* ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† 3 Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø§Øª ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
                grid-template-columns: repeat(3, var(--cell-size));
                grid-template-rows: repeat(5, var(--cell-size)); /* 5 ØµÙÙˆÙ Ù„Ù€ 15 Ø®Ù„ÙŠØ© */
            }
            .grid.size-18 {
                /* ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† 4 Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø§Øª ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
                grid-template-columns: repeat(4, var(--cell-size));
                grid-template-rows: repeat(5, var(--cell-size)); /* 5 ØµÙÙˆÙ Ù„Ù€ 18 Ø®Ù„ÙŠØ© - Ø³ÙŠØ¨Ù‚Ù‰ Ù‡Ù†Ø§Ùƒ Ø®Ù„Ø§ÙŠØ§ ÙØ§Ø±ØºØ© ÙÙŠ Ø§Ù„ØµÙ Ø§Ù„Ø£Ø®ÙŠØ± */
            }
            .cell.value-revealed {
                font-size: clamp(2em, 8vw, 4em); /* Adjust for smaller screens */
            }
            .cell.text-content {
                font-size: clamp(12px, 2.8vw, 20px);
            }
            .cell[data-round-type="words"],
            .cell[data-round-type="math"],
            .cell[data-round-type="letter-word"],
            .cell[data-round-type="incomplete-word"] {
                font-size: clamp(10px, 2vw, 18px);
            }
            .cell[data-round-type="emoji"],
            .cell[data-special-type="star-placeholder"] {
                font-size: clamp(18px, 4vw, 30px);
            }
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø© */
        .falling-letter {
            position: absolute;
            top: -50px;
            font-size: 2.5em;
            color: rgba(0, 51, 102, 0.3);
            animation: fall linear infinite;
            pointer-events: none;
            user-select: none;
            opacity: 0;
            z-index: -1;
        }

        @keyframes fall {
            0% { transform: translateY(-50px) translateX(0) scale(0.8); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0; }
            100% { transform: translateY(100vh) translateX(0) scale(1.2); opacity: 0; }
        }

    </style>
</head>
<body>

    <div class="legal-notice">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ù„Ø´Ø®Øµ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙˆØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ø´Ø± Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ¹. ÙˆÙ…Ù† ÙŠØ®Ø§Ù„Ù Ø°Ù„Ùƒ Ø³ÙŠØªÙ… Ø§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±.
        <span>ÙˆÙ„Ù„ØªØ°ÙƒÙŠØ± Ø¨Ø°Ù…ØªÙƒ ÙˆØ£Ù…Ø§Ù†ØªÙƒ: "Ù‚Ø§Ù„ ï·º: Ù„Ø§ Ø¥ÙŠÙ…Ø§Ù† Ù„Ù…Ù† Ù„Ø§ Ø£Ù…Ø§Ù†Ø© Ù„Ù‡ØŒ ÙˆÙ„Ø§ Ø¯ÙŠÙ† Ù„Ù…Ù† Ù„Ø§ Ø¹Ù‡Ø¯ Ù„Ù‡"</span>
    </div>

    <div id="countdownOverlay" class="modal-overlay"> <div id="countdownText"></div>
        <div id="countdownNumber"></div>
    </div>

    <div id="finalWinnerModal" class="modal-overlay"> <div class="modal-content">
            <h2 id="finalWinnerText"></h2>
            <p id="finalTieText"></p>
            <div class="button-group">
                <button id="playAgainBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <button id="startTieBreakerBtn" style="display: none;">Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„</button>
            </div>
        </div>
    </div>


    <div class="modal-overlay" id="adviceModal"> <div class="modal-content">
            <h2>Ù†ØµÙŠØ­Ø© Ø¹Ù„Ø´Ø§Ù† Ù†Ù„Ø¹Ø¨ ÙˆÙ†Ø³ØªØ§Ù†Ø³â€¦ Ø¨Ø³ Ø¨Ø¯ÙˆÙ† Ù…Ø§ Ù†Ù†Ø³Ù‰ Ø§Ù„Ø£Ù‡Ù… ğŸŒ™</h2>
            <ul>
                <li>â° "Ø§Ù„Ù„Ø¹Ø¨ Ù…Ù…ØªØ¹ØŒ Ø¨Ø³ Ø®Ù„Ù‘Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©ØŒ Ø¹Ø´Ø§Ù† Ù…Ø§ ØªØ¶ÙŠØ¹ Ø¹Ù„ÙŠÙƒ Ù„Ø§ Ù…ØªØ¹Ø© ÙˆÙ„Ø§ Ø£Ø¬Ø±."</li>
                <li>ğŸ“– "Ø§Ù„Ù„Ø¹Ø¨Ø© Ø­Ù„ÙˆØ©ØŒ Ø¨Ø³ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø£Ø­Ù„Ù‰ØŒ Ø®Ø° Ù„Ùƒ ÙˆÙ‚Øª Ø¨ÙŠÙ† Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ÙˆØ§Ø±ØªÙ‘Ø­ Ù…Ø¹ ÙƒÙ„Ø§Ù… Ø§Ù„Ù„Ù‡."</li>
                <li>ğŸ™ "Ø¥Ø°Ø§ Ø¬Ø§Ø¡ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø©ØŒ Ù†ÙˆÙ‚Ù Ø§Ù„Ù„Ø¹Ø¨ ÙˆÙ†ÙƒØ³Ø¨ Ø±Ø¶Ø§ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†."</li>
                <li>âœ‹ "Ù†Ù„Ø¹Ø¨ ÙˆÙ†Ø¶Ø­ÙƒØŒ Ù„ÙƒÙ† Ù…Ø§ Ù†Ø®Ù„ÙŠ Ø§Ù„Ù„Ø¹Ø¨ ÙŠÙ„Ù‡ÙŠÙ†Ø§ Ø¹Ù† Ø·Ø§Ø¹Ø© Ø§Ù„Ù„Ù‡."</li>
                <li>ğŸ“š "Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø²Ø¡ Ù…Ù† ÙŠÙˆÙ…Ù†Ø§ØŒ Ù…Ùˆ ÙƒÙ„ ÙŠÙˆÙ…Ù†Ø§â€¦ Ù„Ø§ ØªÙ†Ø³Ù‰ Ø£Ù‡Ø¯Ø§ÙÙƒ ÙˆØ·Ù…ÙˆØ­Ø§ØªÙƒ."</li>
                <li>ğŸ¯ "Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø§ ØªÙ…Ù†Ø¹ Ø¥Ù†Ùƒ ØªØ°Ø§ÙƒØ±ØŒ Ù†Ø¸Ù‘Ù… ÙˆÙ‚ØªÙƒ ÙˆØ®Ù„Ù‘ Ø§Ù„Ù„Ø¹Ø¨ Ù…ÙƒØ§ÙØ£Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²."</li>
                <li>âŒ› "ÙˆÙ‚Øª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© ØºØ§Ù„ÙŠØŒ Ù„Ø§ ØªØ®Ù„ÙŠÙ‡ ÙŠØ¶ÙŠØ¹ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø¬ÙŠÙ… Ù…Ù…ÙƒÙ† ØªÙ„Ø¹Ø¨Ù‡ Ø¨Ø£ÙŠ ÙˆÙ‚Øª."</li>
            </ul>
            <p>"Ø¥Ø°Ø§ Ù„Ø¹Ø¨Øª ÙˆØ£Ù†Øª Ù…Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØµÙ„Ø§ØªÙƒ ÙˆØ£Ø°ÙƒØ§Ø±Ùƒ ÙˆÙ‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ®Ù„ØµØª Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© ÙˆØ§Ù„Ø£Ø´ØºØ§Ù„ Ø§Ù„Ù„ÙŠ Ø¹Ù„ÙŠÙƒâ€¦ Ø£Ù†Øª ÙƒØ³Ø¨Øª Ø§Ù„Ø¯Ù†ÙŠØ§ ÙˆØ§Ù„Ø¢Ø®Ø±Ø© Ø¨Ø¥Ø°Ù† Ø§Ù„Ù„Ù‡"</p>
            <div class="button-group">
                <button onclick="showInstructionsModal()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="instructionsModal"> <div class="modal-content">
            <h2>ğŸ“ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ø¹Ø¨Ø© ØµÙŠØ¯Ù‡Ø§ ğŸ®</h2>
            <ul>
                <li>ğŸŒŸ **Ø§Ù„Ù‡Ø¯Ù:** Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø£Ùˆ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø£Ùˆ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø© ÙÙŠ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø´Ø¨ÙƒØ©.</li>
                <li>1ï¸âƒ£ **Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ¦Ø©:** (Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø©).</li>
                <li>2ï¸âƒ£ **Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©:** Ø§Ø¶ØºØ· Ø²Ø± **Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©** Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ù…ÙˆØ² Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù…Ø¯Ø© Ù…Ø­Ø¯Ø¯Ø© â³ Ù…Ø¹ Ø¹Ø¯Ø§Ø¯ ÙŠØ¸Ù‡Ø± Ø§Ù„ÙˆÙ‚Øª. Ø®Ù„Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©ØŒ Ø­Ø§ÙˆÙ„ ØªØ°ÙƒØ± Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø±Ù…ÙˆØ².</li>
                <li>3ï¸âƒ£ **Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø±Ù…ÙˆØ²:** Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª â°ØŒ ØªØ¹ÙˆØ¯ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·ØŒ Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø®Ù„ÙŠØªÙŠÙ†:
                    <ul>
                        <li>âœ… Ø¥Ø°Ø§ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø±Ù…Ø²Ø§Ù†ØŒ ÙŠÙƒØ³Ø¨ Ø§Ù„ÙØ±ÙŠÙ‚ Ø£Ùˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù†Ù‚Ø·Ø© Ø¹Ù„Ù‰ ÙƒÙ„ ØªØ·Ø§Ø¨Ù‚ ØµØ­ÙŠØ­.</li>
                        <li>âŒ Ø¥Ø°Ø§ Ù„Ù… ØªØªØ·Ø§Ø¨Ù‚ØŒ Ù„Ø§ ÙŠÙƒØ³Ø¨ Ø£ÙŠ Ù†Ù‚Ø·Ø©.</li>
                    </ul>
                </li>
                <li>4ï¸âƒ£ **Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ø¬Ù…Ø© â­:** Ø¥Ø°Ø§ ÙƒØ´ÙØª Ø¨Ø·Ø§Ù‚Ø© **Ø§Ù„Ù†Ø¬Ù…Ø© â­**ØŒ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø®ØµÙ… Ù†Ù‚Ø§Ø· Ù…Ù† Ø±ØµÙŠØ¯ ÙØ±ÙŠÙ‚Ùƒ! (ØªØªØºÙŠØ± Ù‚ÙŠÙ…ØªÙ‡Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ Ø¨ÙŠÙ† Ø³Ø§Ù„Ø¨ ÙˆÙ…ÙˆØ¬Ø¨ ÙˆØªØ²ÙŠØ¯ Ù…Ø¹ ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬ÙˆÙ„Ø§ØªØŒ ÙˆÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­Ù‡Ø§!).</li>
                <li>5ï¸âƒ£ **Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©:** Ø¹Ù†Ø¯ Ø§Ù„ÙƒØ´Ù Ø¹Ù† ÙƒÙ„ **Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©**ØŒ Ø³ØªÙƒÙˆÙ† Ø§Ù„Ø¬ÙˆÙ„Ø© Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª. Ø§Ù„Ù„Ø¹Ø¨Ø© Ø³ØªÙ†ØªÙ‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©.</li>
                <li>6ï¸âƒ£ **Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:** Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ Ø³ÙŠØ¸Ù‡Ø± Ø²Ø± **"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©"** Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ÙŠØ¯ÙˆÙŠÙ‹Ø§.</li>
                <li>ğŸ”„ **Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†:** ÙŠØ¹ÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ù„ØªØ®ØªØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚ Ø£Ùˆ ØªØ¹ÙŠØ¯ Ø§Ù„Ø¬ÙˆÙ„Ø©.</li>
            </ul>
            <div class="button-group">
                <button onclick="hideInstructionsAndShowTeamSelection()">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="teamSelectionModal"> <div class="modal-content">
            <h2>Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚</h2>
            <div class="team-options">
                <button onclick="selectTeams(2)">2 ÙØ±Ù‚</button>
                <button onclick="selectTeams(3)">3 ÙØ±Ù‚</button>
                <button onclick="selectTeams(4)">4 ÙØ±Ù‚</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="teamNameInputModal"> <div class="modal-content">
            <h2>Ø³Ù…Ù‘Ù Ø§Ù„ÙØ±Ù‚</h2>
            <div class="team-name-inputs" id="teamNameInputsContainer">
                </div>
            <div class="button-group">
                <button onclick="confirmTeamNames()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="resetConfirmationModal">
        <div class="modal-content">
            <h2>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</h2>
            <p>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŸ Ø³ØªÙÙ‚Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p>
            <div class="button-group">
                <button id="confirmResetBtn">ØªØ£ÙƒÙŠØ¯</button>
                <button id="cancelResetBtn">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <div class="game-area">
        <div class="scoreboard" id="scoreboard">
            </div>

        <div class="result" id="result"></div>

        <div class="timer" id="timerContainer"></div>

        <div class="grid" id="grid"></div>

        <div class="controls">
            <button onclick="handleStartOrNextRound()" id="startGameBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
            <button onclick="nextGroupManually()" id="nextGroupBtn" style="display: none;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
            <button onclick="showResetConfirmation()" id="resetGameBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        </div>
    </div>

    <script>
        // ØªØ¹Ø±ÙŠÙ ÙØ¦Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø§Øª (Ù…Ø­Ø¯Ø«Ø©)
        const roundCategories = [
            "ÙÙˆØ§ÙƒÙ‡", "Ø®Ø¶Ø±ÙˆØ§Øª", "Ø§Ù„Ø£Ø¯ÙˆØ§Øª", "Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª", // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
            "Ø§Ù„Ø­Ø±Ù ÙˆØ§Ù„ÙƒÙ„Ù…Ø©", "Ø£ÙƒÙ…Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©", "Ù…Ø±Ø§Ø¯Ù Ø§Ù„ÙƒÙ„Ù…Ø©", "Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ¹ÙƒØ³Ù‡Ø§", // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
            "Ø¹Ù…Ù„ÙŠØ© Ø¬Ù…Ø¹", "Ø¹Ù…Ù„ÙŠØ© Ø·Ø±Ø­", "Ø¹Ù…Ù„ÙŠØ© Ø¶Ø±Ø¨", "Ø¹Ù…Ù„ÙŠØ© Ù‚Ø³Ù…Ø©" // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
        ];

        // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
        const group1Rounds = [
            { emojis: ["ğŸ", "ğŸŒ", "ğŸ‡", "ğŸŠ", "ğŸ“", "ğŸ", "ğŸ¥­", "ğŸ¥"], gridSizeClass: "size-18", timer: 10, category: roundCategories[0], specialSquaresCount: 2, totalEmojiPairs: 8, type: "emoji" },
            { emojis: ["ğŸ¥•", "ğŸ¥”", "ğŸ§…", "ğŸ¥¦", "ğŸ¥’", "ğŸŒ¶ï¸", "ğŸ†", "ğŸŒ½"], gridSizeClass: "size-18", timer: 10, category: roundCategories[1], specialSquaresCount: 2, totalEmojiPairs: 8, type: "emoji" },
            { emojis: ["ğŸ”¨", "ğŸ”§", "ğŸ’¡", "âœ‚ï¸", "ğŸ“Œ", "ğŸ”‘", "ğŸ”‹", "ğŸ“±"], gridSizeClass: "size-18", timer: 5, category: roundCategories[2], specialSquaresCount: 2, totalEmojiPairs: 8, type: "emoji" },
            { emojis: ["ğŸš—", "ğŸšŒ", "ğŸš²", "ğŸš†", "ğŸš", "ğŸš¤", "ğŸ›µ", "ğŸš¢"], gridSizeClass: "size-18", timer: 5, category: roundCategories[3], specialSquaresCount: 2, totalEmojiPairs: 8, type: "emoji" }
        ];

        // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
        const group2Rounds = [
            { letterWordPairs: [["Ø£", "Ø£Ø³Ø¯"], ["Ø¨", "Ø¨Ù‚Ø±Ø©"], ["Øª", "ØªÙ…Ø³Ø§Ø­"], ["Ø¬", "Ø¬Ù…Ù„"], ["Ø­", "Ø­ØµØ§Ù†"], ["Ø¯", "Ø¯Ø¨"], ["Ø²", "Ø²Ø±Ø§ÙØ©"]], gridSizeClass: "size-15", timer: 10, category: roundCategories[4], specialSquaresCount: 1, totalEmojiPairs: 7, type: "letter-word" },
            { incompleteWordPairs: [["ÙƒØªØ§Ø¨", "ÙƒØª_Ø¨", "Ø§"], ["Ù‚Ù„Ù…", "Ù‚_Ù…", "Ù„"], ["Ø´Ù…Ø³", "Ø´_Ø³", "Ù…"], ["Ù‚Ù…Ø±", "Ù‚_Ø±", "Ù…"], ["Ø¨Ø­Ø±", "Ø¨_Ø±", "Ø­"], ["ÙˆØ±Ø¯Ø©", "ÙˆØ±_Ø©", "Ø¯"], ["ØªÙØ§Ø­", "Øª_Ø§Ø­", "Ù"]], gridSizeClass: "size-15", timer: 10, category: roundCategories[5], specialSquaresCount: 1, totalEmojiPairs: 7, type: "incomplete-word" },
            { textPairs: [["Ø³Ø¹ÙŠØ¯", "ÙØ±Ø­"], ["ÙƒØ¨ÙŠØ±", "Ø¶Ø®Ù…"], ["ØµØºÙŠØ±", "Ø¶Ø¦ÙŠÙ„"], ["Ø³Ø±ÙŠØ¹", "Ø¹Ø§Ø¬Ù„"], ["Ø¨Ø·ÙŠØ¡", "Ù…ØªØ¨Ø§Ø·Ø¦"], ["Ø¬Ù…ÙŠÙ„", "Ø­Ù„Ùˆ"], ["Ø°ÙƒÙŠ", "Ø¹Ø¨Ù‚Ø±ÙŠ"]], gridSizeClass: "size-15", timer: 5, category: roundCategories[6], specialSquaresCount: 1, totalEmojiPairs: 7, type: "words" },
            { textPairs: [["ØµØºÙŠØ±", "ÙƒØ¨ÙŠØ±"], ["Ù‚Ø±ÙŠØ¨", "Ø¨Ø¹ÙŠØ¯"], ["Ø·ÙˆÙŠÙ„", "Ù‚ØµÙŠØ±"], ["Ø­Ø§Ø±", "Ø¨Ø§Ø±Ø¯"], ["Ù„ÙŠÙ„", "Ù†Ù‡Ø§Ø±"], ["ØµØ¹ÙˆØ¯", "Ù‡Ø¨ÙˆØ·"], ["Ø¯Ø§Ø®Ù„", "Ø®Ø§Ø±Ø¬"]], gridSizeClass: "size-15", timer: 5, category: roundCategories[7], specialSquaresCount: 1, totalEmojiPairs: 7, type: "words" }
        ];

        // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©)
        const group3Rounds = [
            { mathPairs: [["2+3", "5"], ["5+4", "9"], ["10+2", "12"], ["7+1", "8"], ["6+6", "12"], ["9+3", "12"], ["4+7", "11"]], gridSizeClass: "size-15", timer: 15, category: roundCategories[8], specialSquaresCount: 1, totalEmojiPairs: 7, type: "math" },
            { mathPairs: [["8-2", "6"], ["7-3", "4"], ["10-5", "5"], ["9-1", "8"], ["12-4", "8"], ["11-6", "5"], ["15-7", "8"]], gridSizeClass: "size-15", timer: 15, category: roundCategories[9], specialSquaresCount: 1, totalEmojiPairs: 7, type: "math" },
            { mathPairs: [["2*3", "6"], ["4*2", "8"], ["5*5", "25"], ["3*7", "21"], ["6*4", "24"], ["8*3", "24"], ["7*5", "35"]], gridSizeClass: "size-15", timer: 15, category: roundCategories[10], specialSquaresCount: 1, totalEmojiPairs: 7, type: "math" },
            { mathPairs: [["10/2", "5"], ["12/3", "4"], ["15/5", "3"], ["18/6", "3"], ["20/4", "5"], ["24/8", "3"], ["28/7", "4"]], gridSizeClass: "size-15", timer: 15, category: roundCategories[11], specialSquaresCount: 1, totalEmojiPairs: 7, type: "math" }
        ];

        let allGameRounds = [group1Rounds, group2Rounds, group3Rounds]; // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„
        const tieBreakerEmojis = [
            "505", "515", "525", "535", "545", "555", "575"
        ];
        const tieBreakerTimer = 5;
        const tieBreakerSpecialSquaresCount = 1; // Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„ Ù…Ø±Ø¨Ø¹ Ø®Ø§Øµ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
        const tieBreakerFixedValue = 4; // Ù‚ÙŠÙ…Ø© Ø«Ø§Ø¨ØªØ© 4 Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„ (ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† +4 Ø£Ùˆ -4)
        const tieBreakerTotalEmojiPairs = 7;

        const interRoundDelay = 10; // ÙˆÙ‚Øª Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø¬ÙˆÙ„Ø§Øª (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ 10 Ø«ÙˆØ§Ù†ÙŠ)

        let teamNames = { // Default team names, will be updated by user input
            "blue": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚",
            "red": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±",
            "green": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¶Ø±",
            "orange": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ"
        };
        const teamColors = ["blue", "red", "green", "orange"];
        // Define actual CSS colors for team names for consistency
        const teamCssColors = {
            "blue": "#004085",
            "red": "#721c24",
            "green": "#155724",
            "orange": "#856404"
        };
        let activeTeams = [];
        let currentTeamIndex = 0;
        let startingTeamIndexForRound = 0;

        let currentGroupIndex = 0; // Ù…Ø¤Ø´Ø± Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (0 Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ 1 Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©)
        let roundIndex = 0; // Ù…Ø¤Ø´Ø± Ù„Ù„Ø¬ÙˆÙ„Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©

        let board = [];
        let firstPick = null;
        let lockBoard = false;
        let scores = {}; // Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¢Ù† ØªØ±Ø§ÙƒÙ…ÙŠØ©
        let matchedPairsCount = 0; // Ù„Ø¹Ø¯ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© ÙÙ‚Ø·
        let timerInterval = null;
        let isTieBreakerRound = false;
        let gameInitialized = false; // Ù…ØªØºÙŠØ± Ø¬Ø¯ÙŠØ¯ Ù„ØªØªØ¨Ø¹ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù‡ÙŠØ£Ø© (Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¸Ø§Ù‡Ø±Ø© ÙˆÙ…Ø³ØªØ¹Ø¯Ø© Ù„Ù„Ø¨Ø¯Ø¡)
        let isTransitioning = false; // Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¹Ø¯Ø§Ø¯

        const adviceModal = document.getElementById("adviceModal");
        const instructionsModal = document.getElementById("instructionsModal");
        const teamSelectionModal = document.getElementById("teamSelectionModal");
        const teamNameInputModal = document.getElementById("teamNameInputModal"); // New modal for team names
        const teamNameInputsContainer = document.getElementById("teamNameInputsContainer"); // Container for team name inputs
        const gameArea = document.querySelector(".game-area");
        const grid = document.getElementById("grid");
        const timerContainer = document.getElementById("timerContainer");
        const resultDisplay = document.getElementById("result");
        const startGameBtn = document.getElementById("startGameBtn");
        const nextGroupBtn = document.getElementById("nextGroupBtn"); // Ø²Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        const resetGameBtn = document.getElementById("resetGameBtn");
        const scoreboardDiv = document.getElementById("scoreboard");
        let scoreBoardElements = {};
        const countdownOverlay = document.getElementById("countdownOverlay");
        const countdownText = document.getElementById("countdownText");
        const countdownNumber = document.getElementById("countdownNumber");
        const finalWinnerModal = document.getElementById("finalWinnerModal");
        const finalWinnerText = document.getElementById("finalWinnerText");
        const finalTieText = document.getElementById("finalTieText");
        const playAgainBtn = document.getElementById("playAgainBtn");
        const startTieBreakerBtn = document.getElementById("startTieBreakerBtn");
        const resetConfirmationModal = document.getElementById("resetConfirmationModal"); // New modal
        const confirmResetBtn = document.getElementById("confirmResetBtn");
        const cancelResetBtn = document.getElementById("cancelResetBtn");

        const arabicLetters = ['Ø§', 'Ø¨', 'Øª', 'Ø«', 'Ø¬', 'Ø­', 'Ø®', 'Ø¯', 'Ø°', 'Ø±', 'Ø²', 'Ø³', 'Ø´', 'Øµ', 'Ø¶', 'Ø·', 'Ø¸', 'Ø¹', 'Øº', 'Ù', 'Ù‚', 'Ùƒ', 'Ù„', 'Ù…', 'Ù†', 'Ù‡', 'Ùˆ', 'ÙŠ'];
        const confettiColors = ["#f44336", "#e91e63", "#9c27b0", "#673ab7", "#3f51b5", "#2196f3", "#03a9f4", "#00bcd4", "#009688", "#4CAF50", "#8BC34A", "#CDDC39", "#FFEB3B", "#FFC107", "#FF9800", "#FF5722", "#795548", "#9E9E9E", "#607D8B"];

        // --- ÙˆØ¸Ø§Ø¦Ù ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØ§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…ØªØ³Ø§Ù‚Ø·Ø© ---
        function createFallingLetter() {
            const letter = document.createElement('span');
            letter.textContent = arabicLetters[Math.floor(Math.random() * arabicLetters.length)];
            letter.classList.add('falling-letter');
            letter.style.left = `${Math.random() * 100}vw`;
            letter.style.animationDuration = `${Math.random() * 8 + 5}s`;
            letter.style.animationDelay = `${Math.random() * 5}s`;
            document.body.appendChild(letter);
            letter.addEventListener('animationend', () => {
                letter.remove();
                createFallingLetter();
            });
        }

        for (let i = 0; i < 20; i++) {
            createFallingLetter();
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©) ---
        function showAdviceModal() {
            adviceModal.classList.add('show');
            gameArea.style.display = 'none';
            finalWinnerModal.classList.remove('show');
            clearConfetti();
        }

        function showInstructionsModal() {
            adviceModal.classList.remove('show');
            instructionsModal.classList.add('show');
        }

        function hideInstructionsAndShowTeamSelection() {
            instructionsModal.classList.remove('show');
            showTeamSelectionModal();
        }

        function showTeamSelectionModal() {
            teamSelectionModal.classList.add('show');
        }

        function hideAllModals() {
            adviceModal.classList.remove('show');
            instructionsModal.classList.remove('show');
            teamSelectionModal.classList.remove('show');
            teamNameInputModal.classList.remove('show');
            finalWinnerModal.classList.remove('show');
            countdownOverlay.classList.remove('show');
            resetConfirmationModal.classList.remove('show');
            clearConfetti();
        }

        let selectedNumTeams = 0; // Store the number of teams selected

        function selectTeams(numTeams) {
            selectedNumTeams = numTeams; // Store the number of teams
            hideAllModals();
            showTeamNameInputModal(numTeams); // Show team name input modal
        }

        function showTeamNameInputModal(numTeams) {
            teamNameInputsContainer.innerHTML = ''; // Clear previous inputs
            // Define default names based on color order
            const defaultNames = {
                "blue": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚",
                "red": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±",
                "green": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¶Ø±",
                "orange": "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ"
            };
            for (let i = 0; i < numTeams; i++) {
                const teamColor = teamColors[i]; // Get the color code
                const inputDiv = document.createElement('div');
                const label = document.createElement('label');
                label.textContent = `${defaultNames[teamColor]}:`; // Use default name for label
                label.setAttribute('for', `teamName${i}`);
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `teamName${i}`;
                input.name = `teamName${i}`;
                input.value = teamNames[teamColor] || defaultNames[teamColor]; // Pre-fill with current custom name or default
                input.dataset.teamColor = teamColor; // Store the color in dataset
                inputDiv.appendChild(label);
                inputDiv.appendChild(input);
                teamNameInputsContainer.appendChild(inputDiv);
            }
            teamNameInputModal.classList.add('show');
        }

        function confirmTeamNames() {
            const teamNameInputs = teamNameInputsContainer.querySelectorAll('input[type="text"]');
            teamNameInputs.forEach(input => {
                const teamColor = input.dataset.teamColor;
                teamNames[teamColor] = input.value.trim() || teamNames[teamColor]; // Update with custom name, or keep current default if empty
            });
            hideAllModals();
            initializeGameSetup(); // Proceed to game setup after names are confirmed
        }

        function initializeGameSetup() {
            activeTeams = teamColors.slice(0, selectedNumTeams); // Use selectedNumTeams
            scores = {};
            activeTeams.forEach(team => {
                scores[team] = 0; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
            });

            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            scoreboardDiv.innerHTML = '';
            activeTeams.forEach(team => {
                const teamDiv = document.createElement('div');
                teamDiv.classList.add('team', team);
                teamDiv.dataset.team = team;
                teamDiv.innerHTML = `${teamNames[team]}: <span id="score${team.charAt(0).toUpperCase() + team.slice(1)}">0</span>`;
                scoreboardDiv.appendChild(teamDiv);
            });
            scoreBoardElements = {};
            activeTeams.forEach(color => {
                const elem = document.querySelector(`.team.${color}`);
                if (elem) scoreBoardElements[color] = elem;
            });

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¬ÙˆÙ„Ø© ÙˆØ§Ù„ÙØ±ÙŠÙ‚ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©
            currentTeamIndex = 0;
            startingTeamIndexForRound = 0;
            currentGroupIndex = 0; // Ù†Ø¨Ø¯Ø£ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
            roundIndex = 0; // ÙˆÙ†Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¯Ø§Ø®Ù„Ù‡Ø§
            isTieBreakerRound = false;
            matchedPairsCount = 0;

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø© Ù„Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡Ù†Ø§ØŒ ÙˆÙ„ÙƒÙ† Ø³ØªÙƒÙˆÙ† Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§
            const initialRoundData = allGameRounds[currentGroupIndex][roundIndex];
            createBoard(initialRoundData);
            hideAllCards(); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®ÙØ§Ø¦Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
            disableClicking(); // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø± Ø­ØªÙ‰ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©
            timerContainer.textContent = ""; // Ù…Ø³Ø­ Ù†Øµ Ø§Ù„Ù…Ø¤Ù‚Øª
            resultDisplay.textContent = `Ø¯ÙˆØ± ÙØ±ÙŠÙ‚: ${teamNames[activeTeams[currentTeamIndex]]}`;
            updateActiveTeamDisplay(); // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù†Ø´Ø·

            // Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ø¢Ù†
            gameArea.style.display = 'flex';
            startGameBtn.textContent = "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©"; // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù†Øµ Ø§Ù„Ø²Ø±
            startGameBtn.style.display = 'inline-block';
            nextGroupBtn.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            resetGameBtn.style.display = 'inline-block';
            enableControls(); // ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ù‚Ø·Ø©
            gameInitialized = true; // Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¢Ù† Ù…Ù‡ÙŠØ£Ø© ÙˆØ¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¨Ø¯Ø¡
            isTransitioning = false; // ØªØ£ÙƒÙŠØ¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
            console.log("Game initialized and ready to start.");
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function createBoard(roundData) {
            grid.innerHTML = '';
            grid.className = 'grid ' + roundData.gridSizeClass;
            board = [];
            firstPick = null;
            lockBoard = false;

            let contents = [];
            let specialSquares = [];

            if (roundData.type === "emoji") {
                contents = [...roundData.emojis, ...roundData.emojis];
            } else if (roundData.type === "words" || roundData.type === "math") {
                roundData.textPairs.forEach(pair => {
                    contents.push(pair[0]);
                    contents.push(pair[1]);
                });
            } else if (roundData.type === "letter-word") {
                roundData.letterWordPairs.forEach(pair => {
                    contents.push(pair[0]);
                    contents.push(pair[1]);
                });
            } else if (roundData.type === "incomplete-word") {
                roundData.incompleteWordPairs.forEach(pair => {
                    contents.push(pair[0]); // Ø§Ù„ÙƒÙ„Ù…Ø© ÙƒØ§Ù…Ù„Ø©
                    contents.push(pair[1]); // Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù†Ø§Ù‚ØµØ©
                });
            } else if (isTieBreakerRound) {
                contents = [...tieBreakerEmojis, ...tieBreakerEmojis];
            }

            shuffle(contents);

            // Add special squares
            for (let i = 0; i < roundData.specialSquaresCount; i++) {
                specialSquares.push({
                    type: "star",
                    value: (Math.random() < 0.5 ? 1 : -1) * (isTieBreakerRound ? tieBreakerFixedValue : getRandomStarValue(currentGroupIndex))
                });
            }

            // Determine total cells based on the round type
            let totalCells;
            if (roundData.gridSizeClass === "size-15") {
                totalCells = 15; // 5 columns x 3 rows
            } else if (roundData.gridSizeClass === "size-18") {
                totalCells = 18; // 6 columns x 3 rows
            } else {
                totalCells = contents.length + specialSquares.length; // Fallback
            }


            let cellsContent = [];
            for(let i=0; i<contents.length; i++) {
                cellsContent.push({ value: contents[i], type: roundData.type });
            }
            // Add star placeholders
            specialSquares.forEach(star => {
                cellsContent.push({ value: 'â­', type: 'special', specialType: 'star-placeholder', originalStarValue: star.value });
            });

            // If there are more cells defined in totalCells than content available, fill with empty placeholders
            while (cellsContent.length < totalCells) {
                cellsContent.push({ value: '', type: 'empty' }); // Use empty string for placeholder
            }

            shuffle(cellsContent); // Shuffle all content (regular and special)

            cellsContent.forEach((cellData, index) => {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = index;
                cell.dataset.value = cellData.value;
                cell.dataset.type = cellData.type;

                if (cellData.specialType) {
                    cell.dataset.specialType = cellData.specialType;
                    cell.dataset.originalStarValue = cellData.originalStarValue;
                }

                // Add text-content class if it's not an emoji round
                if (cellData.type !== "emoji") {
                    cell.classList.add('text-content');
                }

                board.push(cell);
                grid.appendChild(cell);
            });

            matchedPairsCount = 0; // Reset matched pairs count for the new round
        }


        function hideAllCards() {
            board.forEach(cell => {
                cell.textContent = cell.dataset.index + 1; // Show numbers
                cell.classList.remove('matched', 'value-revealed', 'negative', 'positive');
                cell.classList.add('hidden'); // Hide content
                cell.onclick = () => pickCard(cell); // Re-enable clicks
            });
        }

        function revealAllCards() {
            board.forEach(cell => {
                if (!cell.classList.contains('matched')) {
                    cell.textContent = cell.dataset.value; // Show actual content
                    cell.classList.remove('hidden'); // Remove hidden class
                }
            });
        }

        function hideSpecificCards(card1, card2) {
            lockBoard = true;
            setTimeout(() => {
                card1.textContent = card1.dataset.index + 1;
                card2.textContent = card2.dataset.index + 1;
                card1.classList.add('hidden');
                card2.classList.add('hidden');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [firstPick, lockBoard] = [null, false];
        }

        function disableClicking() {
            board.forEach(cell => {
                cell.onclick = null; // Remove click event listener
            });
        }

        function enableClicking() {
            board.forEach(cell => {
                if (!cell.classList.contains('matched') && !cell.classList.contains('value-revealed')) {
                    cell.onclick = () => pickCard(cell);
                } else {
                    cell.onclick = null; // Ensure matched/revealed cells cannot be clicked
                }
            });
        }

        function pickCard(card) {
            if (lockBoard || card.classList.contains('matched') || card.classList.contains('value-revealed') || card === firstPick) {
                return;
            }

            // Prevent picking empty cells
            if (card.dataset.type === 'empty') {
                return;
            }

            card.textContent = card.dataset.value;
            card.classList.remove('hidden');

            // Handle special star square
            if (card.dataset.specialType === 'star-placeholder') {
                handleStarSquare(card);
                return; // Exit as star squares don't require matching
            }

            if (!firstPick) {
                firstPick = card;
                return;
            }

            // Second pick
            lockBoard = true;
            checkMatch(card);
        }

        function checkMatch(secondPick) {
            const currentRound = isTieBreakerRound ?
                { type: "emoji", totalEmojiPairs: tieBreakerTotalEmojiPairs } :
                allGameRounds[currentGroupIndex][roundIndex];

            let isMatch = false;

            if (currentRound.type === "emoji" || isTieBreakerRound) {
                isMatch = firstPick.dataset.value === secondPick.dataset.value;
            } else if (currentRound.type === "words" || currentRound.type === "math") {
                // For words/math, need to check both directions of the pair
                const roundData = allGameRounds[currentGroupIndex][roundIndex];
                const pairs = (roundData.type === "words") ? roundData.textPairs : roundData.mathPairs;
                isMatch = pairs.some(pair =>
                    (firstPick.dataset.value === pair[0] && secondPick.dataset.value === pair[1]) ||
                    (firstPick.dataset.value === pair[1] && secondPick.dataset.value === pair[0])
                );
            } else if (currentRound.type === "letter-word") {
                const roundData = allGameRounds[currentGroupIndex][roundIndex];
                const pairs = roundData.letterWordPairs;
                isMatch = pairs.some(pair =>
                    (firstPick.dataset.value === pair[0] && secondPick.dataset.value === pair[1]) ||
                    (firstPick.dataset.value === pair[1] && secondPick.dataset.value === pair[0])
                );
            } else if (currentRound.type === "incomplete-word") {
                const roundData = allGameRounds[currentGroupIndex][roundIndex];
                const pairs = roundData.incompleteWordPairs;
                isMatch = pairs.some(pair =>
                    (firstPick.dataset.value === pair[0] && secondPick.dataset.value === pair[1]) ||
                    (firstPick.dataset.value === pair[1] && secondPick.dataset.value === pair[0])
                );
            }

            if (isMatch) {
                matchedPairsCount++;
                activeTeams.forEach(team => updateScoreboard(team)); // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
                updateScore(activeTeams[currentTeamIndex], 1); // ÙÙ‚Ø· Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø°ÙŠ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø¯ÙˆØ± ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·
                [firstPick, secondPick].forEach(card => card.classList.add('matched'));
                resetBoard();
                checkRoundEnd();
            } else {
                hideSpecificCards(firstPick, secondPick);
                endTurn(); // Change turn only on incorrect match
            }
        }


        function handleStarSquare(card) {
            lockBoard = true; // Lock board temporarily while star value is revealed
            card.classList.add('value-revealed');
            const starValue = parseInt(card.dataset.originalStarValue);

            card.textContent = starValue > 0 ? `+${starValue}` : starValue; // Show + or -

            if (starValue > 0) {
                card.classList.add('positive');
            } else {
                card.classList.add('negative');
            }

            updateScore(activeTeams[currentTeamIndex], starValue);
            updateScoreboard(activeTeams[currentTeamIndex]);

            setTimeout(() => {
                card.classList.remove('value-revealed', 'positive', 'negative');
                card.classList.add('hidden');
                card.textContent = card.dataset.index + 1; // Revert to number and hide
                resetBoard();
                endTurn(); // End turn after star square interaction
            }, 1500);
        }


        function updateScore(team, points) {
            scores[team] += points;
            document.getElementById(`score${team.charAt(0).toUpperCase() + team.slice(1)}`).textContent = scores[team];
        }

        function updateActiveTeamDisplay() {
            activeTeams.forEach((team, index) => {
                const teamDiv = scoreBoardElements[team];
                if (teamDiv) {
                    if (index === currentTeamIndex) {
                        teamDiv.classList.add('active');
                        resultDisplay.textContent = `Ø¯ÙˆØ± ÙØ±ÙŠÙ‚: ${teamNames[team]}`;
                    } else {
                        teamDiv.classList.remove('active');
                    }
                }
            });
        }

        function endTurn() {
            currentTeamIndex = (currentTeamIndex + 1) % activeTeams.length;
            updateActiveTeamDisplay();
        }

        function checkRoundEnd() {
            const currentRound = isTieBreakerRound ?
                { totalEmojiPairs: tieBreakerTotalEmojiPairs } :
                allGameRounds[currentGroupIndex][roundIndex];

            if (matchedPairsCount >= currentRound.totalEmojiPairs) {
                // All regular pairs matched, round is over
                setTimeout(goToNextRoundOrGroup, 1500); // Small delay before moving to next round
            } else {
                enableClicking(); // Continue allowing clicks if not all pairs matched
            }
        }

        function goToNextRoundOrGroup() {
            disableClicking(); // Disable clicks during transition
            isTransitioning = true;
            clearInterval(timerInterval); // Stop any active timers
            timerContainer.textContent = "";

            hideAllModals(); // Hide any open modals

            if (isTieBreakerRound) {
                determineWinner();
                return;
            }

            roundIndex++;
            let currentGroupRounds = allGameRounds[currentGroupIndex];

            if (roundIndex < currentGroupRounds.length) {
                // Go to next round in the current group
                startInterRoundCountdown(`Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ${roundCategories[currentGroupIndex * 4 + roundIndex]}`);
            } else {
                // All rounds in current group finished
                currentGroupIndex++;
                roundIndex = 0; // Reset round index for the new group

                if (currentGroupIndex < allGameRounds.length) {
                    // Go to next group
                    resultDisplay.textContent = "";
                    startGameBtn.style.display = 'none'; // Hide start game button
                    nextGroupBtn.style.display = 'inline-block'; // Show next group button
                    nextGroupBtn.textContent = `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ${roundCategories[currentGroupIndex * 4]}`; // Show category of next group
                    enableControls(); // Enable the next group button
                } else {
                    // All groups finished, determine winner
                    determineWinner();
                }
            }
        }


        function startInterRoundCountdown(message) {
            countdownOverlay.classList.add('show');
            countdownText.textContent = message;
            let count = interRoundDelay;
            countdownNumber.textContent = count;

            const countdownInter = setInterval(() => {
                count--;
                countdownNumber.textContent = count;
                if (count <= 0) {
                    clearInterval(countdownInter);
                    countdownOverlay.classList.remove('show');
                    if (!isTieBreakerRound) { // Only start new round if not tie-breaker
                         startRound();
                    }
                    isTransitioning = false;
                }
            }, 1000);
        }


        function handleStartOrNextRound() {
            if (isTransitioning) return; // Prevent multiple clicks during transition
            isTransitioning = true;

            nextGroupBtn.style.display = 'none'; // Hide next group button if visible
            startGameBtn.textContent = "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©"; // Ensure it says "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©"

            if (isTieBreakerRound) {
                startTieBreakerRound();
            } else {
                startRound();
            }
        }


        function startRound() {
            const roundData = isTieBreakerRound ?
                { emojis: tieBreakerEmojis, gridSizeClass: "size-15", timer: tieBreakerTimer, specialSquaresCount: tieBreakerSpecialSquaresCount, totalEmojiPairs: tieBreakerTotalEmojiPairs, type: "emoji" } :
                allGameRounds[currentGroupIndex][roundIndex];

            createBoard(roundData);
            matchedPairsCount = 0; // Reset matched pairs for the new round
            firstPick = null;
            lockBoard = false;
            currentTeamIndex = startingTeamIndexForRound; // Start with the same team as the beginning of the round
            updateActiveTeamDisplay();

            revealAllCards(); // Show all cards for the timer duration
            disableClicking(); // Disable clicking during reveal phase

            let timeLeft = roundData.timer;
            timerContainer.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft} Ø«ÙˆØ§Ù†ÙŠ`;

            timerInterval = setInterval(() => {
                timeLeft--;
                timerContainer.textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${timeLeft} Ø«ÙˆØ§Ù†ÙŠ`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    hideAllCards(); // Hide cards after timer ends
                    enableClicking(); // Enable clicking after cards are hidden
                    timerContainer.textContent = ""; // Clear timer display
                    isTransitioning = false;
                }
            }, 1000);
        }


        function nextGroupManually() {
            if (isTransitioning) return;
            isTransitioning = true;

            // Hide the "Next Group" button
            nextGroupBtn.style.display = 'none';
            // Show the "Start Game" button and change its text
            startGameBtn.style.display = 'inline-block';
            startGameBtn.textContent = "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©"; // Change button text for the new group's first round

            // Start countdown for the first round of the new group
            startInterRoundCountdown(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ${roundCategories[currentGroupIndex * 4]}`);
        }

        function determineWinner() {
            hideAllModals(); // Hide any active modals
            clearInterval(timerInterval); // Stop any timers
            gameInitialized = false; // Mark game as not initialized

            let maxScore = -Infinity;
            activeTeams.forEach(team => {
                if (scores[team] > maxScore) {
                    maxScore = scores[team];
                }
            });

            const winningTeams = activeTeams.filter(team => scores[team] === maxScore);

            if (winningTeams.length === 1) {
                const winnerColor = winningTeams[0];
                const winnerName = teamNames[winnerColor];
                finalWinnerText.textContent = `Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„ÙØ§Ø¦Ø²: ${winnerName}! ğŸ‰`;
                finalWinnerText.style.color = teamCssColors[winnerColor]; // Set winning text color
                finalTieText.textContent = ""; // Clear tie text
                startConfettiEffect();
                startTieBreakerBtn.style.display = 'none'; // Ensure tie breaker button is hidden
            } else {
                finalWinnerText.textContent = `ØªØ¹Ø§Ø¯Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙØ±Ù‚! ğŸ¤`;
                finalWinnerText.style.color = "#007bff"; // Blue for tie
                finalTieText.textContent = "ÙŠÙ…ÙƒÙ†ÙƒÙ… Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© ØªØ¹Ø§Ø¯Ù„ Ù„ÙƒØ³Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„.";
                startTieBreakerBtn.style.display = 'inline-block'; // Show tie breaker button
            }

            finalWinnerModal.classList.add('show');
            disableControls(); // Disable game buttons
        }

        function getRandomStarValue(groupIndex) {
            // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (ÙƒÙ„Ù…Ø§ ØªÙ‚Ø¯Ù…Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø²Ø§Ø¯Øª Ø§Ù„Ù‚ÙŠÙ…)
            let minVal = 1;
            let maxVal = 2;
            if (groupIndex === 1) { // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©
                minVal = 2;
                maxVal = 3;
            } else if (groupIndex === 2) { // Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©
                minVal = 3;
                maxVal = 4;
            }
            // Ø§Ø®ØªÙŠØ§Ø± Ù‚ÙŠÙ…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø¨ÙŠÙ† minVal Ùˆ maxVal
            return Math.floor(Math.random() * (maxVal - minVal + 1)) + minVal;
        }

        // Functions for Confetti Effect
        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
            confetti.style.animationDelay = `${Math.random() * 2}s`;
            document.body.appendChild(confetti);

            confetti.addEventListener('animationend', () => {
                confetti.remove();
            });
        }

        let confettiInterval = null;

        function startConfettiEffect() {
            // Clear any existing confetti interval first
            clearConfetti();
            // Create a burst of confetti initially
            for (let i = 0; i < 50; i++) {
                createConfetti();
            }
            // Continue creating confetti at intervals
            confettiInterval = setInterval(() => {
                for (let i = 0; i < 10; i++) {
                    createConfetti();
                }
            }, 500);
        }

        function clearConfetti() {
            if (confettiInterval) {
                clearInterval(confettiInterval);
                confettiInterval = null;
            }
            document.querySelectorAll('.confetti').forEach(c => c.remove());
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ---
        function disableControls() {
            startGameBtn.disabled = true;
            nextGroupBtn.disabled = true;
            resetGameBtn.disabled = true;
        }

        function enableControls() {
            startGameBtn.disabled = false;
            nextGroupBtn.disabled = false;
            resetGameBtn.disabled = false;
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ù„ØªØ¹Ø§Ø¯Ù„ ---
        function showResetConfirmation() {
            resetConfirmationModal.classList.add('show');
        }

        confirmResetBtn.addEventListener('click', () => {
            hideAllModals(); // Hide confirmation modal
            resetGame();
        });

        cancelResetBtn.addEventListener('click', () => {
            hideAllModals(); // Hide confirmation modal
        });


        function resetGame() {
            hideAllModals();
            clearConfetti();
            clearInterval(timerInterval); // Stop any running timer

            // Reset game state variables
            currentGroupIndex = 0;
            roundIndex = 0;
            currentTeamIndex = 0;
            startingTeamIndexForRound = 0;
            isTieBreakerRound = false;
            matchedPairsCount = 0;
            firstPick = null;
            lockBoard = false;
            gameInitialized = false;
            isTransitioning = false;

            // Clear scoreboard
            scoreboardDiv.innerHTML = '';
            // Clear grid
            grid.innerHTML = '';
            grid.className = 'grid'; // Remove any size classes
            timerContainer.textContent = "";
            resultDisplay.textContent = "";

            // Reset button states
            startGameBtn.textContent = "Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©";
            startGameBtn.style.display = 'inline-block';
            nextGroupBtn.style.display = 'none';
            resetGameBtn.style.display = 'inline-block';
            enableControls();

            // Hide game area until selection is made
            gameArea.style.display = 'none';

            // Show advice modal to start fresh
            showAdviceModal();
        }

        playAgainBtn.addEventListener('click', resetGame);

        startTieBreakerBtn.addEventListener('click', () => {
            hideAllModals();
            clearConfetti();
            isTieBreakerRound = true;
            currentGroupIndex = allGameRounds.length; // Ensure this is beyond normal rounds
            roundIndex = 0; // Reset round index for tie-breaker
            startingTeamIndexForRound = 0; // Reset starting team for tie-breaker
            currentTeamIndex = 0;
            matchedPairsCount = 0; // Reset matched pairs for tie-breaker
            scores = {}; // Reset scores for a fresh tie-breaker
            activeTeams.forEach(team => {
                scores[team] = 0;
                document.getElementById(`score${team.charAt(0).toUpperCase() + team.slice(1)}`).textContent = scores[team]; // Update displayed scores
            });
            startInterRoundCountdown("Ø¬ÙˆÙ„Ø© ÙƒØ³Ø± Ø§Ù„ØªØ¹Ø§Ø¯Ù„!");
            startGameBtn.style.display = 'inline-block';
            startGameBtn.textContent = "Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„";
            nextGroupBtn.style.display = 'none';
            enableControls();
            gameArea.style.display = 'flex'; // Show game area
        });


        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', showAdviceModal);

    </script>
</body>
</html>
